!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CoCreate=e():(t.CoCreate=t.CoCreate||{},t.CoCreate.crud=e())}(this,(function(){return t={446:function(t,e){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(t){function e(){let e={};return t&&t.config&&(e=t.config),{apiKey:e.apiKey,organization_id:e.organization_Id}}function n(e){let n={};return t&&t.config&&(n=t.config),{apiKey:e.apiKey||n.apiKey,organization_id:e.organization_id||n.organization_Id}}function o(e,n){let o={};t&&t.config&&(o=t.config);let r=e||o.organization_Id,s=n||"";return s?`${r}/${s}`:r}function r(t=36){let e=(new Date).getTime(),n=0,o="uxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(t<=o.length)o=o.substr(0,t);else{let e=t-o.length,n="-xxxyyxxx",r=Math.floor(e/n.length);for(let t=0;t<r;t++)o+=n;r=e-r*n.length,o+=n.substr(0,r)}return o.replace(/[xy]/g,(function(t){var o=16*Math.random();return e>0?(o=(e+o)%16|0,e=Math.floor(e/16)):(o=(n+o)%16|0,n=Math.floor(n/16)),("x"==t?o:7&o|8).toString(16)}))}return{getCommonParams:e,getCommonParamsExtend:n,generateSocketClient:o,GenerateUUID:r}}(window)}.apply(e,[]))||(t.exports=n)},585:function(t,e,n){var o,r;"undefined"!=typeof self&&self,o=[n(446)],void 0===(r=function(t){return function(t,e,n,o){class r{constructor(t="crud"){this.prefix=t||"crud",this.sockets=new Map,this.listeners=new Map,this.messageQueue=new Map,this.saveFileName="",this.globalScope=""}setGlobalScope(t){this.globalScope=`${this.prefix}/${t}`}getGlobalScope(){return this.globalScope}create(t){const{namespace:r,room:s}=t,i=this.getKey(r,s);let c,a=this;if(r&&this.setGlobalScope(r),this.sockets.get(i))return void(c=this.sockets.get(i));let l=e.location.protocol;"about:"===e.location.protocol&&(l=e.parent.location.protocol,t.host||(t.host=e.parent.location.host));let u="http:"===l?"ws":"wss";const d=t.port?t.port:8088;let f=`${u}://${e.location.host}:${d}/${i}`;t.host&&(f=t.host.includes("://")?`${t.host}/${i}`:t.host.includes(":")?`${u}://${t.host}/${i}`:`${u}://${t.host}:${d}/${i}`);try{let t=null;e.localStorage&&(t=e.localStorage.getItem("token")),c=new n(f,t)}catch(t){return}c.onopen=function(t){(a.messageQueue.get(i)||[]).forEach((t=>c.send(JSON.stringify(t)))),a.sockets.set(i,c),a.messageQueue.set(i,[])},c.onclose=function(e){switch(e.code){case 1e3:break;default:a.destroy(c,i),a.reconnect(c,t)}},c.onerror=function(e){a.destroy(c,i),a.reconnect(c,t)},c.onmessage=function(t){try{if(e.Blob&&t.data instanceof o)return void a.saveFile(t.data);let r=JSON.parse(t.data);if(r.data.event){if(e.CustomEvent){var n=new e.CustomEvent(r.data.event,{detail:r.data});return void e.document.dispatchEvent(n)}return void process.emit(r.data.event,r.data)}r.action;const s=a.listeners.get(r.action);if(!s)return;s.forEach((t=>{t(r.data,i)}))}catch(t){}}}send(e,n,o){const r={action:e,data:{...n,uid:t.GenerateUUID()}},s=this.getKeyByRoom(o),i=this.getByRoom(o);i?i.send(JSON.stringify(r)):this.messageQueue.get(s)?this.messageQueue.get(s).push(r):this.messageQueue.set(s,[r])}sendFile(t,e){const n=this.getByRoom(e);n&&n.send(t)}listen(t,e){this.listeners.get(t)?this.listeners.get(t).push(e):this.listeners.set(t,[e])}reconnect(t,e){let n=this;setTimeout((function(){n.create(e)}),1e3)}destroy(t,e){t&&(t.onerror=t.onopen=t.onclose=null,t.close(),t=null),this.sockets.get(e)&&this.sockets.delete(e)}destroyByKey(t){let e=this.sockets.get(t);e&&this.destroy(e,t)}getKey(t,e){let n=`${this.prefix}`;return t&&""!=t&&(n+=e&&""!=e?`/${t}/${e}`:`/${t}`),n}getByRoom(t){let e=this.getKeyByRoom(t);return this.sockets.get(e)}getKeyByRoom(t){let e=this.globalScope;return t&&(e=`${this.prefix}/${t}`),e}saveFile(t){if(e.document){const o=this.saveFileName||"downloadFile";var n=e.document.createElement("a");e.document.body.appendChild(n),n.style="display: none";let r=window.URL.createObjectURL(t);n.href=r,n.download=o,n.click(),e.URL.revokeObjectURL(r),this.saveFileName=""}}listenAsync(t){return new Promise(((n,o)=>{e.document?e.document.addEventListener(t,(function(t){n(t.detail)}),{once:!0}):process.once(t,(t=>{n(t)}))}))}}return r}(t,window,WebSocket,Blob)}.apply(e,o))||(t.exports=r)},381:(t,e,n)=>{"use strict";var o,r;"undefined"!=typeof self&&self,o=[n(446),n(158)],void 0===(r=function(t,e){return function(t,e,n){return{socket:null,setSocket:function(t){this.socket=t},readDocumentList:async function(t){if(!t)return!1;let n=e.getCommonParams();if(!t.collection)return!1;n={...n,...t},e.generateSocketClient(t.namespace,t.room);const o=this.socket.send("readDocumentList",n);try{return await this.socket.listenAsync(o)}catch(t){return null}},createDocument:async function(n){if(null===n)return!1;let o=e.getCommonParamsExtend(n),r={...n,...o},s=n.data||{};s.organization_id||(s.organization_id=t.config.organization_Id),n.data&&(s={...s,...n.data}),r.data=s;const i=e.generateSocketClient(n.namespace,n.room);let c=this.socket.send("createDocument",r,i);try{return await this.socket.listenAsync(c)}catch(t){return null}},updateDocument:async function(t){if(!t)return!1;if(t.document_id&&!n.checkDocumentId(t.document_id))return!1;let o=e.getCommonParamsExtend(t),r={...t,...o};if("object"==typeof t.data&&(r.set=t.data),Array.isArray(t.delete_fields)&&(r.unset=t.delete_fields),!r.set&&!r.unset)return!1;!1===t.broadcast&&(r.broadcast=!1),void 0===t.broadcast_sender&&(r.broadcast_sender=!0);const s=e.generateSocketClient(t.namespace,t.room);let i=this.socket.send("updateDocument",r,s);try{return await this.socket.listenAsync(i)}catch(t){return null}},readDocument:async function(t){if(null===t)return null;if(!t||!n.checkDocumentId(t.document_id))return null;let o=e.getCommonParamsExtend(t),r={...t,...o},s=this.socket.send("readDocument",r);try{return e.generateSocketClient(t.namespace,t.room),await this.socket.listenAsync(s)}catch(t){return null}},deleteDocument:async function(t){if(!t||!n.checkDocumentId(t.document_id))return null;let o=e.getCommonParamsExtend(t),r={...t,...o};const s=e.generateSocketClient(t.namespace,t.room);let i=this.socket.send("deleteDocument",r,s);try{return await this.socket.listenAsync(i)}catch(t){return null}},exportCollection:function(t){if(null===t)return;let n=e.getCommonParamsExtend(t);n.collection=t.collection,n.export_type=t.export_type,n.metadata=t.metadata,this.socket.send("exportDB",n)},importCollection:function(n){const{file:o}=n;if(null===n||!(o instanceof t.File))return;const r=o.name.split(".").pop();if(!["json","csv"].some((t=>t===r)))return;let s=e.getCommonParamsExtend(n);s.collection=n.collection,s.import_type=r,this.socket.send("importDB",s),this.socket.sendFile(o)},listen:function(t,e){this.socket.listen(t,e)},listenAsync:function(t){return this.socket.listenAsync(t)},createSocket:function(t,e){e?(this.socket.create({namespace:e,room:null,host:t}),this.socket.setGlobalScope(e)):this.socket.create({namespace:null,room:null,host:t})},...n}}(window,t,e)}.apply(e,o))||(t.exports=r)},352:(t,e,n)=>{"use strict";var o,r;"undefined"!=typeof self&&self,o=[n(585),n(381)],void 0===(r=function(t,e){return function(t,e,n){if(t){let t=window.CoCreateCrudSocket;t||(t=new e("ws"),window.CoCreateCrudSocket=t),n.setSocket(t),n.createSocket(window.config.host?window.config.host:window.location.hostname,window.config.organization_Id)}return n}(!0,t,e)}.apply(e,o))||(t.exports=r)},158:(t,e)=>{"use strict";var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(){function t(e,n){e=e||{};for(let o of Object.keys(n))n[o]instanceof Object&&Object.assign(n[o],t(e[o],n[o]));return Object.assign(e||{},n),e}function e(t,e){if(!e)return t;let n=e.split("."),o=t;for(var r=n.length-1;r>=0;r--)o={[n[r]]:o};return o}function n(t,e){try{let n=/([\w\W]+)\[(\d+)\]/gm.exec(t);if(n&&3==n.length){let o=n[1],r=parseInt(n[2]);e[o]&&Array.isArray(e[o])||(e[o]=[]),e[o][r]=e[t],delete e[t],t=o}}catch{}return t}function o(t,e){try{if(!t||!e)return null;if(e[t])return e[t];let o=t.split("."),r={...e};for(var n=0;n<o.length&&r;n++)r=r[o[n]];return r}catch{return null}}function r(t){return!!t&&t.constructor===Object}function s(t){return!!t&&t.constructor===Array}function i(o){let r=Object.keys(o),s={};return r.forEach((r=>{if((r=n(r,o)).split(".").length>1){let n=e(o[r],r);delete o[r],s=t(s,n)}else s[r]=o[r]})),s}function c(t){let e=Object.keys(t),n={};return e.forEach((e=>{let o=t[e];if(r(t[e])){let o=c(t[e]);Object.keys(o).forEach((t=>{let r=o[t];n[t=e+"."+t]=r}))}else s(o)?o.forEach(((t,o)=>{n[`${e}[${o}]`]=t})):n[e]=t[e]})),n}function a(t){if(t)return{collection:t.getAttribute("data-collection"),document_id:t.getAttribute("data-document_id"),name:t.getAttribute("name")}}function l(t){if(!t)return{};let e=h(t),n=d(t),o=u(t),r=f(t);return m(t),{is_realtime:e,is_save:n,is_read:o,is_update:r}}const u=t=>p(t,"data-read_value"),d=t=>p(t,"data-save_value"),f=t=>p(t,"data-update_value"),m=t=>p(t,"data-flat"),h=t=>!!t&&"false"!=t.getAttribute("data-realtime");function p(t,e){return!!t&&"false"!==t.getAttribute(e)}function g(t){return!!t&&!/{{\s*([\w\W]+)\s*}}/g.test(t)}function y(t){try{let e=JSON.parse(t);return"object"==typeof e&&null!=e}catch(t){return!1}}function x(t){const{collection:e,document_id:n,name:o}=a(t);return!(y(e)||y(o)||!("INPUT"===t.tagName&&["text","email","tel","url"].includes(t.type)||"TEXTAREA"===t.tagName)||!o||!h(t)||"true"===t.getAttribute("data-unique")||"password"===t.type||!u(t))}function k(t){try{return!!t&&"null"!==t.toLowerCase()}catch(t){return!1}}return{decodeObject:i,encodeObject:c,getAttr:a,getFlagAttr:l,isRealtimeAttr:h,isReadAttr:u,isSaveAttr:d,isUpdateAttr:f,isFlatAttr:m,checkValue:g,isCRDT:x,checkDocumentId:k,getValueByPath:o}}()}.apply(e,[]))||(t.exports=n)}},e={},function n(o){var r=e[o];if(void 0!==r)return r.exports;var s=e[o]={exports:{}};return t[o].call(s.exports,s,s.exports,n),s.exports}(352).default;var t,e}));