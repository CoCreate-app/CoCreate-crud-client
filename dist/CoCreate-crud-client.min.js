!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CoCreate=t():(e.CoCreate=e.CoCreate||{},e.CoCreate.crud=t())}(this,(function(){return e={446:function(e,t){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(e){function t(){let t={};return e&&e.config&&(t=e.config),{apiKey:t.apiKey,organization_id:t.organization_Id}}function n(t){let n={};return e&&e.config&&(n=e.config),{apiKey:t.apiKey||n.apiKey,organization_id:t.organization_id||n.organization_Id}}function o(t,n){let o={};e&&e.config&&(o=e.config);let r=t||o.organization_Id,i=n||"";return i?`${r}/${i}`:r}return{getCommonParams:t,getCommonParamsExtend:n,generateSocketClient:o}}(window)}.apply(t,[]))||(e.exports=n)},585:function(e,t,n){var o,r;"undefined"!=typeof self&&self,o=[n(446),n(212)],void 0===(r=function(e,t){return function(e,t,n,o,r){class i{constructor(e="crud"){this.prefix=e||"crud",this.sockets=new Map,this.listeners=new Map,this.messageQueue=new Map,this.saveFileName="",this.globalScope=""}setGlobalScope(e){this.globalScope=`${this.prefix}/${e}`}getGlobalScope(){return this.globalScope}create(e){const{namespace:r,room:i}=e,s=this.getKey(r,i);let c,a=this;if(r&&this.setGlobalScope(r),this.sockets.get(s))return void(c=this.sockets.get(s));let l=t.location.protocol;"about:"===t.location.protocol&&(l=t.parent.location.protocol,e.host||(e.host=t.parent.location.host));let u="http:"===l?"ws":"wss";const d=e.port?e.port:8088;let f=`${u}://${t.location.host}:${d}/${s}`;e.host&&(f=e.host.includes("://")?`${e.host}/${s}`:e.host.includes(":")?`${u}://${e.host}/${s}`:`${u}://${e.host}:${d}/${s}`);try{let e=null;t.localStorage&&(e=t.localStorage.getItem("token")),c=new n(f,e),c.cocreate_connected=!1,this.sockets.set(s,c)}catch(e){return}c.onopen=function(e){c.cocreate_connected||(c.cocreate_connected=!0),(a.messageQueue.get(s)||[]).forEach((e=>c.send(JSON.stringify(e)))),a.messageQueue.set(s,[])},c.onclose=function(t){switch(t.code){case 1e3:break;default:a.destroy(c,s),a.reconnect(c,e)}},c.onerror=function(t){a.destroy(c,s),a.reconnect(c,e)},c.onmessage=function(e){try{if(t.Blob&&e.data instanceof o)return void a.saveFile(e.data);let n=JSON.parse(e.data);if(n.data&&(n.data.uid&&a.__fireEvent(n.data.uid,n.data),n.data.event))return void a.__fireEvent(n.data.event,n.data);n.action;const r=a.listeners.get(n.action);if(!r)return;r.forEach((e=>{e(n.data,s)}))}catch(e){}}}__fireEvent(e,n){if(t.CustomEvent){var o=new t.CustomEvent(e,{detail:n});t.document.dispatchEvent(o)}else process.emit(e,n)}send(e,t,n){const o=r.generate(),i={action:e,data:{...t,uid:o}},s=this.getKeyByRoom(n),c=this.getByRoom(n);return c&&c.cocreate_connected?c.send(JSON.stringify(i)):this.messageQueue.get(s)?this.messageQueue.get(s).push(i):this.messageQueue.set(s,[i]),o}sendFile(e,t){const n=this.getByRoom(t);n&&n.send(e)}listen(e,t){this.listeners.get(e)?this.listeners.get(e).push(t):this.listeners.set(e,[t])}reconnect(e,t){let n=this;setTimeout((function(){n.create(t)}),1e3)}destroy(e,t){e&&(e.onerror=e.onopen=e.onclose=null,e.close(),e=null),this.sockets.get(t)&&this.sockets.delete(t)}destroyByKey(e){let t=this.sockets.get(e);t&&this.destroy(t,e)}getKey(e,t){let n=`${this.prefix}`;return e&&""!=e&&(n+=t&&""!=t?`/${e}/${t}`:`/${e}`),n}getByRoom(e){let t=this.getKeyByRoom(e);return this.sockets.get(t)}getKeyByRoom(e){let t=this.globalScope;return e&&(t=`${this.prefix}/${e}`),t}saveFile(e){if(t.document){const o=this.saveFileName||"downloadFile";var n=t.document.createElement("a");t.document.body.appendChild(n),n.style="display: none";let r=window.URL.createObjectURL(e);n.href=r,n.download=o,n.click(),t.URL.revokeObjectURL(r),this.saveFileName=""}}listenAsync(e){return new Promise(((n,o)=>{let r=setTimeout((()=>{clearTimeout(r),n(null)}),5e3);t.document?t.document.addEventListener(e,(function(e){n(e.detail)}),{once:!0}):process.once(e,(e=>{n(e)}))}))}}return i}(0,window,WebSocket,Blob,t)}.apply(t,o))||(e.exports=r)},212:function(e,t){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(e){const t={attribute:"data-uuid",init:function(t){if(!e.document)return;const n=t||e.document;if(!n.querySelectorAll)return;let o=n.querySelectorAll(`[${this.attribute}]`);const r=this;o.forEach((e=>{const t=parseInt(e.getAttribute(r.attribute))||36,n=r.generate(t);"INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.value=n:e.innerHTML=n}))},generate:function(t=36){let n=(new Date).getTime(),o=e.performance&&e.performance.now&&1e3*e.performance.now()||0,r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(t<=r.length)r=r.substr(0,t);else{let e=t-r.length,n="-xxxyyxxx",o=Math.floor(e/n.length);for(let e=0;e<o;e++)r+=n;o=e-o*n.length,r+=n.substr(0,o)}return r.replace(/[xy]/g,(function(e){var t=16*Math.random();return n>0?(t=(n+t)%16|0,n=Math.floor(n/16)):(t=(o+t)%16|0,o=Math.floor(o/16)),("x"==e?t:7&t|8).toString(16)}))}};return t.init(),t}(window)}.apply(t,[]))||(e.exports=n)},381:(e,t,n)=>{"use strict";var o,r;"undefined"!=typeof self&&self,o=[n(446),n(158)],void 0===(r=function(e,t){return function(e,t,n){return{socket:null,setSocket:function(e){this.socket=e},readDocumentList:async function(e){if(!e)return!1;let n=t.getCommonParams();if(!e.collection)return!1;n={...n,...e},t.generateSocketClient(e.namespace,e.room);const o=this.socket.send("readDocumentList",n);try{return await this.socket.listenAsync(o)}catch(e){return null}},createDocument:async function(n){if(null===n)return!1;let o=t.getCommonParamsExtend(n),r={...n,...o},i=n.data||{};i.organization_id||(i.organization_id=e.config.organization_Id),n.data&&(i={...i,...n.data}),r.data=i;const s=t.generateSocketClient(n.namespace,n.room);let c=this.socket.send("createDocument",r,s);try{return await this.socket.listenAsync(c)}catch(e){return null}},updateDocument:async function(e){if(!e)return!1;if(e.document_id&&!n.checkDocumentId(e.document_id))return!1;let o=t.getCommonParamsExtend(e),r={...e,...o};if("object"==typeof e.data&&(r.set=e.data),Array.isArray(e.delete_fields)&&(r.unset=e.delete_fields),!r.set&&!r.unset)return!1;!1===e.broadcast&&(r.broadcast=!1),void 0===e.broadcast_sender&&(r.broadcast_sender=!0);const i=t.generateSocketClient(e.namespace,e.room);let s=this.socket.send("updateDocument",r,i);try{return await this.socket.listenAsync(s)}catch(e){return null}},readDocument:async function(e){if(null===e)return null;if(!e||!n.checkDocumentId(e.document_id))return null;let o=t.getCommonParamsExtend(e),r={...e,...o},i=this.socket.send("readDocument",r);try{return t.generateSocketClient(e.namespace,e.room),await this.socket.listenAsync(i)}catch(e){return null}},deleteDocument:async function(e){if(!e||!n.checkDocumentId(e.document_id))return null;let o=t.getCommonParamsExtend(e),r={...e,...o};const i=t.generateSocketClient(e.namespace,e.room);let s=this.socket.send("deleteDocument",r,i);try{return await this.socket.listenAsync(s)}catch(e){return null}},exportCollection:function(e){if(null===e)return;let n=t.getCommonParamsExtend(e);n.collection=e.collection,n.export_type=e.export_type,n.metadata=e.metadata,this.socket.send("exportDB",n)},importCollection:function(n){const{file:o}=n;if(null===n||!(o instanceof e.File))return;const r=o.name.split(".").pop();if(!["json","csv"].some((e=>e===r)))return;let i=t.getCommonParamsExtend(n);i.collection=n.collection,i.import_type=r,this.socket.send("importDB",i),this.socket.sendFile(o)},listen:function(e,t){this.socket.listen(e,t)},listenAsync:function(e){return this.socket.listenAsync(e)},createSocket:function(e,t){t?(this.socket.create({namespace:t,room:null,host:e}),this.socket.setGlobalScope(t)):this.socket.create({namespace:null,room:null,host:e})},...n}}(window,e,t)}.apply(t,o))||(e.exports=r)},352:(e,t,n)=>{"use strict";var o,r;"undefined"!=typeof self&&self,o=[n(585),n(381)],void 0===(r=function(e,t){return function(e,t,n){if(e){let e=window.CoCreateCrudSocket;e||(e=new t("ws"),window.CoCreateCrudSocket=e),n.setSocket(e),n.createSocket(window.config.host?window.config.host:window.location.hostname,window.config.organization_Id)}return n}(!0,e,t)}.apply(t,o))||(e.exports=r)},158:(e,t)=>{"use strict";var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(){function e(t,n){t=t||{};for(let o of Object.keys(n))n[o]instanceof Object&&Object.assign(n[o],e(t[o],n[o]));return Object.assign(t||{},n),t}function t(e,t){if(!t)return e;let n=t.split("."),o=e;for(var r=n.length-1;r>=0;r--)o={[n[r]]:o};return o}function n(e,t){try{let n=/([\w\W]+)\[(\d+)\]/gm.exec(e);if(n&&3==n.length){let o=n[1],r=parseInt(n[2]);t[o]&&Array.isArray(t[o])||(t[o]=[]),t[o][r]=t[e],delete t[e],e=o}}catch{}return e}function o(e,t){try{if(!e||!t)return null;if(t[e])return t[e];let o=e.split("."),r={...t};for(var n=0;n<o.length&&r;n++)r=r[o[n]];return r}catch{return null}}function r(e){return!!e&&e.constructor===Object}function i(e){return!!e&&e.constructor===Array}function s(o){let r=Object.keys(o),i={};return r.forEach((r=>{if((r=n(r,o)).split(".").length>1){let n=t(o[r],r);delete o[r],i=e(i,n)}else i[r]=o[r]})),i}function c(e){let t=Object.keys(e),n={};return t.forEach((t=>{let o=e[t];if(r(e[t])){let o=c(e[t]);Object.keys(o).forEach((e=>{let r=o[e];n[e=t+"."+e]=r}))}else i(o)?o.forEach(((e,o)=>{n[`${t}[${o}]`]=e})):n[t]=e[t]})),n}function a(e){if(e)return{collection:e.getAttribute("data-collection"),document_id:e.getAttribute("data-document_id"),name:e.getAttribute("name")}}function l(e){if(!e)return{};let t=p(e),n=d(e),o=u(e),r=f(e);return m(e),{is_realtime:t,is_save:n,is_read:o,is_update:r}}const u=e=>h(e,"data-read_value"),d=e=>h(e,"data-save_value"),f=e=>h(e,"data-update_value"),m=e=>h(e,"data-flat"),p=e=>!!e&&"false"!=e.getAttribute("data-realtime");function h(e,t){return!!e&&"false"!==e.getAttribute(t)}function g(e){return!!e&&!/{{\s*([\w\W]+)\s*}}/g.test(e)}function y(e){try{let t=JSON.parse(e);return"object"==typeof t&&null!=t}catch(e){return!1}}function x(e){const{collection:t,document_id:n,name:o}=a(e);return!(y(t)||y(o)||!("INPUT"===e.tagName&&["text","email","tel","url"].includes(e.type)||"TEXTAREA"===e.tagName)||!o||!p(e)||"true"===e.getAttribute("data-unique")||"password"===e.type||!u(e))}function k(e){try{return!!e&&"null"!==e.toLowerCase()}catch(e){return!1}}return{decodeObject:s,encodeObject:c,getAttr:a,getFlagAttr:l,isRealtimeAttr:p,isReadAttr:u,isSaveAttr:d,isUpdateAttr:f,isFlatAttr:m,checkValue:g,isCRDT:x,checkDocumentId:k,getValueByPath:o}}()}.apply(t,[]))||(e.exports=n)}},t={},function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}(352).default;var e,t}));