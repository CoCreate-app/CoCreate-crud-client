!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CoCreate=t():(e.CoCreate=e.CoCreate||{},e.CoCreate.crud=t())}(this,(function(){return e={446:function(e,t){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(e){function t(){let t={};return e&&e.config&&(t=e.config),{apiKey:t.apiKey,securityKey:t.securityKey,organization_id:t.organization_Id}}function n(t){let n={};return e&&e.config&&(n=e.config),{apiKey:t.apiKey||n.apiKey,securityKey:t.securityKey||n.securityKey,organization_id:t.organization_id||n.organization_Id}}function o(t,n){let o={};e&&e.config&&(o=e.config);let s=t||o.organization_Id,i=n||"";return i?`${s}/${i}`:s}return{getCommonParams:t,getCommonParamsExtend:n,generateSocketClient:o}}(window)}.apply(t,[]))||(e.exports=n)},585:function(e,t){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(e,t,n){class o{constructor(e="crud"){this.prefix=e||"crud",this.sockets=new Map,this.listeners=new Map,this.messageQueue=new Map,this.saveFileName="",this.globalScope=""}setGlobalScope(e){this.globalScope=`${this.prefix}/${e}`}getGlobalScope(){return this.globalScope}create(o){const{namespace:s,room:i}=o,r=this.getKey(s,i);let c,a=this;if(s&&this.setGlobalScope(s),this.sockets.get(r))return void(c=this.sockets.get(r));let u=e.location.protocol;"about:"===e.location.protocol&&(u=e.parent.location.protocol);let l="http:"===u?"ws":"wss";const d=o.port?o.port:8088;let f=`${l}://${e.location.host}:${d}/${r}`;o.host&&(f=o.host.includes("://")?`${o.host}/${r}`:o.host.includes(":")?`${l}://${o.host}/${r}`:`${l}://${o.host}:${d}/${r}`);try{c=new t(f)}catch(e){}c.onopen=function(e){(a.messageQueue.get(r)||[]).forEach((e=>c.send(JSON.stringify(e)))),a.sockets.set(r,c),a.messageQueue.set(r,[])},c.onclose=function(e){switch(e.code){case 1e3:break;default:a.destroy(c,r),a.reconnect(c,o)}},c.onerror=function(e){a.destroy(c,r),a.reconnect(c,o)},c.onmessage=function(t){try{if(e.Blob&&t.data instanceof n)return void a.saveFile(t.data);let s=JSON.parse(t.data);if(s.data.event){if(e.CustomEvent){var o=new e.CustomEvent(s.data.event,{detail:s.data});return void e.document.dispatchEvent(o)}return void process.emit(s.data.event,s.data)}s.action;const i=a.listeners.get(s.action);if(!i)return;i.forEach((e=>{e(s.data,r)}))}catch(e){}}}send(e,t,n){const o={action:e,data:t},s=this.getKeyByRoom(n),i=this.getByRoom(n);i?i.send(JSON.stringify(o)):this.messageQueue.get(s)?this.messageQueue.get(s).push(o):this.messageQueue.set(s,[o])}sendFile(e,t){const n=this.getByRoom(t);n&&n.send(e)}listen(e,t){this.listeners.get(e)?this.listeners.get(e).push(t):this.listeners.set(e,[t])}reconnect(e,t){let n=this;setTimeout((function(){n.create(t)}),1e3)}destroy(e,t){e&&(e.onerror=e.onopen=e.onclose=null,e.close(),e=null),this.sockets.get(t)&&this.sockets.delete(t)}destroyByKey(e){let t=this.sockets.get(e);t&&this.destroy(t,e)}getKey(e,t){let n=`${this.prefix}`;return e&&""!=e&&(n+=t&&""!=t?`/${e}/${t}`:`/${e}`),n}getByRoom(e){let t=this.getKeyByRoom(e);return this.sockets.get(t)}getKeyByRoom(e){let t=this.globalScope;return e&&(t=`${this.prefix}/${e}`),t}saveFile(t){if(e.document){const o=this.saveFileName||"downloadFile";var n=e.document.createElement("a");e.document.body.appendChild(n),n.style="display: none";let s=window.URL.createObjectURL(t);n.href=s,n.download=o,n.click(),e.URL.revokeObjectURL(s),this.saveFileName=""}}listenAsync(t){return new Promise(((n,o)=>{e.document?e.document.addEventListener(t,(function(e){n(e.detail)}),{once:!0}):process.once(t,(e=>{n(e)}))}))}}return o}(window,WebSocket,Blob)}.apply(t,[]))||(e.exports=n)},541:(e,t,n)=>{"use strict";var o,s;"undefined"!=typeof self&&self,o=[n(446),n(158)],void 0===(s=function(e,t){return function(e,t,n){return{socket:null,setSocket:function(e){this.socket=e},readDocumentList(e){if(!e)return;let n=t.getCommonParams();e.collection&&e.operator&&(n={...n,...e},this.socket.send("readDocumentList",n))},createDocument:function(n){if(null===n)return;let o=t.getCommonParamsExtend(n),s={...n,...o},i=n.data||{};i.organization_id||(i.organization_id=e.config.organization_Id),n.data&&(i={...i,...n.data}),s.data=i;const r=t.generateSocketClient(n.namespace,n.room);this.socket.send("createDocument",s,r)},updateDocument:function(e){if(!e||!n.checkDocumentId(e.document_id))return;let o=t.getCommonParamsExtend(e),s={...e,...o};if("object"==typeof e.data&&(s.set=e.data),Array.isArray(e.delete_fields)&&(s.unset=e.delete_fields),!s.set&&!s.unset)return;!1===e.broadcast&&(s.broadcast=!1),void 0===e.broadcast_sender&&(s.broadcast_sender=!0);const i=t.generateSocketClient(e.namespace,e.room);this.socket.send("updateDocument",s,i)},readDocument:function(e){if(null===e)return;if(!e||!n.checkDocumentId(e.document_id))return;let o=t.getCommonParamsExtend(e),s={...e,...o};this.socket.send("readDocument",s)},deleteDocument:function(e){if(!e||!n.checkDocumentId(e.document_id))return;let o=t.getCommonParamsExtend(e),s={...e,...o};const i=t.generateSocketClient(e.namespace,e.room);this.socket.send("deleteDocument",s,i)},exportCollection:function(e){if(null===e)return;let n=t.getCommonParamsExtend(e);n.collection=e.collection,n.export_type=e.export_type,n.metadata=e.metadata,this.socket.send("exportDB",n)},importCollection:function(n){const{file:o}=n;if(null===n||!(o instanceof e.File))return;const s=o.name.split(".").pop();if(!["json","csv"].some((e=>e===s)))return;let i=t.getCommonParamsExtend(n);i.collection=n.collection,i.import_type=s,this.socket.send("importDB",i),this.socket.sendFile(o)},listen:function(e,t){this.socket.listen(e,t)},listenAsync:function(e){return this.socket.listenAsync(e)},createSocket:function(e,t){t?(this.socket.create({namespace:t,room:null,host:e}),this.socket.setGlobalScope(t)):this.socket.create({namespace:null,room:null,host:e})},...n}}(window,e,t)}.apply(t,o))||(e.exports=s)},352:(e,t,n)=>{"use strict";var o,s;"undefined"!=typeof self&&self,o=[n(585),n(541)],void 0===(s=function(e,t){return function(e,t,n){if(e){let e=new t("ws");n.setSocket(e),n.createSocket(window.config.host?window.config.host:window.location.hostname,window.config.organization_Id)}return n}(!0,e,t)}.apply(t,o))||(e.exports=s)},158:(e,t)=>{"use strict";var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(){function e(t,n){t=t||{};for(let o of Object.keys(n))n[o]instanceof Object&&Object.assign(n[o],e(t[o],n[o]));return Object.assign(t||{},n),t}function t(e,t){if(!t)return e;let n=t.split("."),o=e;for(var s=n.length-1;s>=0;s--)o={[n[s]]:o};return o}function n(e,t){try{let n=/([\w\W]+)\[(\d+)\]/gm.exec(e);if(n&&3==n.length){let o=n[1],s=parseInt(n[2]);t[o]&&Array.isArray(t[o])||(t[o]=[]),t[o][s]=t[e],delete t[e],e=o}}catch{}return e}function o(e){return!!e&&e.constructor===Object}function s(e){return!!e&&e.constructor===Array}function i(o){let s=Object.keys(o),i={};return s.forEach((s=>{if((s=n(s,o)).split(".").length>1){let n=t(o[s],s);delete o[s],i=e(i,n)}else i[s]=o[s]})),i}function r(e){let t=Object.keys(e),n={};return t.forEach((t=>{let i=e[t];if(o(e[t])){let o=r(e[t]);Object.keys(o).forEach((e=>{let s=o[e];n[e=t+"."+e]=s}))}else s(i)?i.forEach(((e,o)=>{n[`${t}[${o}]`]=e})):n[t]=e[t]})),n}function c(e){if(e)return{collection:e.getAttribute("data-collection"),document_id:e.getAttribute("data-document_id"),name:e.getAttribute("name")}}function a(e){return e?{is_realtime:f(e),is_save:l(e),is_read:u(e),is_update:d(e)}:{}}const u=e=>m(e,"data-read_value"),l=e=>m(e,"data-save_value"),d=e=>m(e,"data-update_value"),f=e=>!!e&&"false"!=e.getAttribute("data-realtime");function m(e,t){return!!e&&"false"!==e.getAttribute(t)}function p(e){return!!e&&!/{{\s*([\w\W]+)\s*}}/g.test(e)}function h(e){try{let t=JSON.parse(e);return"object"==typeof t&&null!=t}catch(e){return!1}}function g(e){const{collection:t,document_id:n,name:o}=c(e);return!(h(t)||h(o)||!("INPUT"===e.tagName&&["text","email","tel","url"].includes(e.type)||"TEXTAREA"===e.tagName)||!o||!f(e)||"true"===e.getAttribute("data-unique")||"password"===e.type||!u(e))}function y(e){try{return!!e&&"null"!==e.toLowerCase()}catch(e){return!1}}return{decodeObject:i,encodeObject:r,getAttr:c,getFlagAttr:a,isRealtimeAttr:f,isReadAttr:u,isSaveAttr:l,isUpdateAttr:d,checkValue:p,isCRDT:g,checkDocumentId:y}}()}.apply(t,[]))||(e.exports=n)}},t={},function n(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}(352).default;var e,t}));